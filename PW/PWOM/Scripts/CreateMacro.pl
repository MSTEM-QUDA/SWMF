#!/usr/bin/perl -s

my $Help = ($h or $help);
my $Debug = ($d or $debug);
my $Verbose = ($v or $verbose);

use strict;
use FileHandle;
use Cwd;

my $dir = cwd;
&print_help if $Help;

my $plot;

my @plot_file = sort glob "plot_snapshot????_iAlt380.dat";

my $nfile = @plot_file;

open OUT, ">Macro.mcr";

my $iPlot=1;
foreach $plot (@plot_file) {
    if ($iPlot eq 1){
	
	print OUT "#!MC 1000
\$!VarSet |MFBD| = '${dir}' 
\$!READDATASET  '\"|MFBD|/${plot}\" ' 
  READDATAOPTION = NEW
  RESETSTYLE = YES
  INCLUDETEXT = NO
  INCLUDEGEOM = NO
  INCLUDECUSTOMLABELS = NO
  INITIALPLOTFIRSTZONEONLY = YES
  VARLOADMODE = BYNAME
  INITIALPLOTTYPE = CARTESIAN2D
  VARNAMELIST = '\"X\" \"Y\" \"Z\" \"uO\" \"uHe\" \"uH\" \"ue\" \"lgnO\" \"lgnHe\" \"lgnH\" \"lgne\" \"TO\" \"THe\" \"TH\" \"Te\" \"MO\" \"MH\" \"MHe\" \"Me\" \"Ef\" \"Pe\"' 
\$!FIELDLAYERS SHOWMESH = NO
\$!FIELDLAYERS SHOWBOUNDARY = NO
\$!TRIANGULATE 
  SOURCEZONES =  [1]
  USEBOUNDARY = NO
  INCLUDEBOUNDARYPTS = NO
  TRIANGLEKEEPFACTOR = 0.25
\$!DELETEZONES  [1]
\$!GLOBALCONTOUR 1  VAR = 8
\$!CONTOURLEVELS RESETTONICE
  CONTOURGROUP = 1
  APPROXNUMVALUES = 15
\$!FIELDLAYERS SHOWCONTOUR = YES";
	
    }
    $iPlot++;
    print OUT "
\$!READDATASET  '\"|MFBD|/${plot}\" ' 
   READDATAOPTION = APPEND
   RESETSTYLE = NO
   INCLUDETEXT = NO
   INCLUDEGEOM = NO
   INCLUDECUSTOMLABELS = NO
   INITIALPLOTFIRSTZONEONLY = YES
   VARLOADMODE = BYNAME
   INITIALPLOTTYPE = CARTESIAN2D
   VARNAMELIST = '\"X\" \"Y\" \"Z\" \"uO\" \"uHe\" \"uH\" \"ue\" \"lgnO\" \"lgnHe\" \"lgnH\" \"lgne\" \"TO\" \"THe\" \"TH\" \"Te\" \"MO\" \"MH\" \"MHe\" \"Me\" \"Ef\" \"Pe\"' 
\$!TRIANGULATE 
   SOURCEZONES =  [${iPlot}]
   USEBOUNDARY = NO
   INCLUDEBOUNDARYPTS = NO
   TRIANGLEKEEPFACTOR = 0.25
\$!DELETEZONES  [${iPlot}]";
}

#add grid
print OUT "
\$!VIEW FIT
\$!ROTATE2DDATA 
  ANGLE = 90
  X = 0
  Y = 0
  ZONELIST =  [1-${iPlot}]
\$!REDRAW 
\$!ATTACHGEOM 
  GEOMTYPE = CIRCLE
  ANCHORPOS
    {
    X = -0.391791746062
    Y = 0.341928152071
    }
  RAWDATA
0.388357311487 
\$!PICK SETMOUSEMODE
  MOUSEMODE = SELECT
\$!PICK ADD
  X = 2.97349823322
  Y = 4.0968786808
\$!PICK ADD
  X = 2.9617196702
  Y = 4.10865724382
\$!PICK ADD
  X = 2.9617196702
  Y = 4.10865724382
\$!PICK CLEAR
\$!ATTACHGEOM 
  GEOMTYPE = CIRCLE
  LINETHICKNESS = 0.4
  RAWDATA
0.5 
\$!ATTACHGEOM 
  GEOMTYPE = CIRCLE
  ANCHORPOS
    {
    X = -0.569439836481
    Y = 0.443441346596
    }
  RAWDATA
0.110661864281 
\$!PICK SETMOUSEMODE
  MOUSEMODE = SELECT
\$!PICK ADD
  X = 2.51413427562
  Y = 1.88250883392
\$!PICK CLEAR
\$!ATTACHGEOM 
  GEOMTYPE = CIRCLE
  LINETHICKNESS = 0.4
  RAWDATA
0.342020153999 
\$!ATTACHGEOM 
  GEOMTYPE = CIRCLE
  ANCHORPOS
    {
    X = -0.522912955657
    Y = 0.418063047964
    }
  RAWDATA
0.143389880657 
\$!PICK SETMOUSEMODE
  MOUSEMODE = SELECT
\$!PICK ADD
  X = 2.29034157833
  Y = 2.3300942285
\$!PICK CLEAR
\$!ATTACHGEOM 
  GEOMTYPE = CIRCLE
  LINETHICKNESS = 0.4
  RAWDATA
0.173648178577 
\$!VIEW FIT
\$!TWODAXIS XDETAIL{SHOWAXIS = NO}
\$!TWODAXIS YDETAIL{SHOWAXIS = NO}
\$!REDRAW 
\$!ATTACHTEXT 
  ANCHORPOS
    {
    X = 41.4605418139
    Y = 88.0054966627
    }
  TEXTSHAPE
    {
    HEIGHT = 16
    }
  TEXT = '12' 
\$!PICK SETMOUSEMODE
  MOUSEMODE = SELECT
\$!PICK ADD
  X = 4.71672555948
  Y = 1.39958775029
\$!PICK SHIFT
  X = -0.494699646643
  Y = 0
\$!PICK ADD
  X = 4.35159010601
  Y = 1.34069493522
\$!PICK COPY
\$!PICK ADD
  X = 4.33981154299
  Y = 1.35247349823
\$!ATTACHTEXT 
  ANCHORPOS
    {
    X = 11.4252061249
    Y = 50.6281900275
    }
  TEXTSHAPE
    {
    HEIGHT = 16
    }
  TEXT = '18' 
\$!PICK SETMOUSEMODE
  MOUSEMODE = SELECT
\$!PICK ADD
  X = 1.67785630153
  Y = 4.10865724382
\$!PICK SHIFT
  X = -0.117785630153
  Y = -0.0353356890459
\$!PICK SHIFT
  X = -0.0706713780919
  Y = 0
\$!PICK SHIFT
  X = -0.0588928150766
  Y = 0
\$!ATTACHTEXT 
  ANCHORPOS
    {
    X = 39.1048292108
    Y = 17.8052610915
    }
  TEXTSHAPE
    {
    HEIGHT = 16
    }
  TEXT = '24' 
\$!PICK SETMOUSEMODE
  MOUSEMODE = SELECT
\$!PICK ADD
  X = 4.49293286219
  Y = 6.62926972909
\$!PICK SHIFT
  X = -0.20023557126
  Y = 0.0588928150766
\$!ATTACHTEXT 
  ANCHORPOS
    {
    X = 65.4888103651
    Y = 52.1986650962
    }
  TEXTSHAPE
    {
    HEIGHT = 16
    }
  TEXT = '6' 
\$!PICK SETMOUSEMODE
  MOUSEMODE = SELECT
\$!PICK ADD
  X = 7.08421672556
  Y = 4.03798586572
\$!PICK SHIFT
  X = -0.164899882214
  Y = 0
\$!PICK ADD
  X = 8.76855123675
  Y = 5.15694935218
\$!ATTACHTEXT 
  ANCHORPOS
    {
    X = 19.3168433451
    Y = 80.4672163329
    }
  TEXTSHAPE
    {
    HEIGHT = 11
    }
  TEXT = '60' 
\$!PICK SETMOUSEMODE
  MOUSEMODE = SELECT
\$!PICK ADD
  X = 2.59658421673
  Y = 1.91784452297
\$!PICK SHIFT
  X = 0.0235571260306
  Y = 0.0353356890459
\$!ATTACHTEXT 
  ANCHORPOS
    {
    X = 26.5017667845
    Y = 71.9866509619
    }
  TEXTSHAPE
    {
    HEIGHT = 11
    }
  TEXT = '70' 
\$!ATTACHTEXT 
  ANCHORPOS
    {
    X = 31.4487632509
    Y = 63.9772281115
    }
  TEXTSHAPE
    {
    HEIGHT = 11
    }
  TEXT = '80' 
\$!RemoveVar |MFBD|
";

exit;
