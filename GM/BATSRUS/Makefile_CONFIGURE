#^CFG COPYRIGHT UM
#^CFG FILE CONFIGURE

#^CFG IF CARTESIAN BEGIN
############################################################################

cartesian_src:
	./Configure.pl -keepall -exe=cartesian -d=CARTESIAN
	cd CARTESIAN; make install

cartesian_conf: cartesian_src
	cd ..; rm -rf BATSRUS_conf; ln -s BATSRUS/CARTESIAN BATSRUS_conf

cartesian: cartesian_src

#^CFG END CARTESIAN
#^CFG IF NOT CARTESIAN BEGIN
############################################################################

spherical_src:
	cd src;\
		mv user_routines_orig.f90 user_routines_tmp.f90;\
		cp user_routines_empty.f90 user_routines_orig.f90
	cd srcPostProc;\
		mv PostIDL.f90 PostIDL.tmp; mv PostIDL_SPH.f90 PostIDL.f90
	./Configure.pl -d=SPHERICAL \
	-off=boriscorr,cartesian \
	-on=awflux,lindeflux,faceouterbc,testing,userfiles -u
	cd src; \
		mv user_routines_tmp.f90 user_routines_orig.f90;
	cd srcPostProc;\
		mv PostIDL.f90 PostIDL_SPH.f90; mv PostIDL.tmp PostIDL.f90
	cd SPHERICAL/Param;\
		mv PARAM.DEFAULT.SPH PARAM.DEFAULT;\
		mv EARTH/SSSSPH EARTH/SSSS;\
		mv PARAM.TEST.SPH PARAM.TEST
	cd SPHERICAL/Param/TESTSUITE/Res/; mv DEFAULT.SPH DEFAULT
	cd SPHERICAL; make install

spherical_conf: spherical_src
	cd ..; rm -rf BATSRUS_conf; ln -s BATSRUS/SPHERICAL BATSRUS_conf

spherical: spherical_src
	cd SPHERICAL; make

############################################################################

covariant_src:
	cd src; mv user_routines_orig.f90 user_routines_tmp.f90;\
	cp user_routines_empty.f90 user_routines_orig.f90
	./Configure.pl -d=COVARIANT -off=boriscorr,cartesian \
		-on=awflux,lindeflux,faceouterbc,testing,userfiles -u
	cd src; mv user_routines_tmp.f90 user_routines_orig.f90
	cd COVARIANT; make install

covariant_conf: covariant_src
	cd ..; rm -rf BATSRUS_conf; ln -s BATSRUS/COVARIANT BATSRUS_conf

covariant: covariant_src
	cd COVARIANT; make

covarcheck_src:
	cd src; mv user_routines_orig.f90 user_routines_tmp.f90;\
	cp user_routines_empty.f90 user_routines_orig.f90
	./Configure.pl -d=COVARCHECK -off=boriscorr \
		-on=awflux,lindeflux,faceouterbc,testing,userfiles -u
	cd src; mv user_routines_tmp.f90 user_routines_orig.f90
	cd COVARCHECK; make install

covarcheck_conf: covarcheck_src
	cd ..; rm -rf BATSRUS_conf; ln -s BATSRUS/COVARCHECK BATSRUS_conf

covarcheck: covarcheck_src
	cd COVARCHECK; make


#^CFG END CARTESIAN
#^CFG IF GLOBALHELIOSPHERE BEGIN
############################################################################

globhelio_src:
	cd src;mv user_routines_orig.f90 user_routines_tmp.f90;\
	cp user/user_routines.f90.globalhelio user_routines_orig.f90;\
	cd ..;\
	./Configure.pl -d=GLOBALHELIOSPHERE -keepall \
	-off=ionosphere,tiegcm,boriscorr,implicit,roeflux,rcm \
	-on=globalheliosphere,cartesian \
	-exe=ionosphere,tiegcm,boriscorr,implicit,roeflux,rcm,globalheliosphere,cartesian \
	-u
	cd src; mv -f user_routines_tmp.f90 user_routines_orig.f90;\
	cd GLOBALHELIOSPHERE; make install

globhelio_conf: globhelio_src
	cd ..; rm -rf BATSRUS_conf; \
	ln -s BATSRUS/GLOBALHELIOSPHERE BATSRUS_conf

globhelio: globhelio_src
	cd GLOBALHELIOSPHERE; make

#^CFG END GLOBALHELIOSPHERE 
#^CFG IF MULTISP BEGIN
############################################################################

multisp_src:
	cd src;mv user_routines_orig.f90 user_routines_tmp.f90;\
	cp user/user_routines.f90.mars user_routines_orig.f90;\
	cd ..;\
	./Configure.pl -d=MULTISP -keepall \
	-off=implicit,ionosphere,tiegcm,rusanovflux,roeflux,awflux \
	-on=multisp \
	-exe=implicit,ionosphere,tiegcm,rusanovflux,roeflux,awflux,multisp \
	-u;\
	cd src; mv -f user_routines_tmp.f90 user_routines_orig.f90
	cd MULTISP; make install; make spherical_src
	cd MULTISP/SPHERICAL; make install

multisp_conf: multisp_src
	cd ..; rm -rf BATSRUS_conf; \
	ln -s BATSRUS/MULTISP/SPHERICAL BATSRUS_conf

multisp: multisp_src
	cd MULTISP/SPHERICAL; make

#^CFG END MULTISP
#^CFG IF ALWAVES BEGIN
############################################################################

relax_src:
	cd src;mv user_routines_orig.f90 user_routines_tmp.f90;\
	cp user/user_routines.f90.heliosphere user_routines_orig.f90;\
	cd ..;\
	./Configure.pl -d=RELAX \
	-on=alwaves,awflux,userfiles,faceouterbc,cellouterbc,testing \
	-off=rusanov,ionosphere,boriscorr -u;\
	cd src; mv -f user_routines_tmp.f90 user_routines_orig.f90
	cd RELAX; make install

relax_conf: relax_src
	cd ..; rm -rf BATSRUS_conf; ln -s BATSRUS/RELAX BATSRUS_conf

relax: relax_src
	cd RELAX; make

#^CFG END ALWAVES
#^CFG IF ALWAVES BEGIN
############################################################################

corelax_src:
	cd src;mv user_routines_orig.f90 user_routines_tmp.f90;\
	cp user/user_routines.f90.heliosphere.covariant user_routines_orig.f90
	./Configure.pl -d=CORELAX -keepall \
	-on=alwaves,awflux,faceouterbc,cellouterbc \
	-off=rusanovflux,ionosphere,tiegcm,boriscorr,implicit \
	-exe=alwaves,awflux,faceouterbc,cellouterbc,rusanovflux,ionosphere,tiegcm,boriscorr,implicit -u;\
	cd src; mv -f user_routines_tmp.f90 user_routines_orig.f90
	cd CORELAX/srcPostProc; \
		mv PostIDL.f90 PostIDL.tmp; mv PostIDL_SPH.f90 PostIDL.f90
	cd CORELAX;\
	./Configure.pl -d=SPHERICAL \
	-off=cartesian \
	-on=alwaves,awflux,faceouterbc,cellouterbc,testing,userfiles -u
	cd CORELAX/srcPostProc; \
		mv PostIDL.f90 PostIDL_SPH.f90;mv PostIDL.tmp PostIDL.f90
	cd CORELAX/SPHERICAL/Param;\
	mv PARAM.DEFAULT.SPH PARAM.DEFAULT;\
	mv EARTH/SSSSPH EARTH/SSSS;\
	cd TESTSUITE/Res/; mv DEFAULT.SPH DEFAULT; cd ../.. ;\
	mv PARAM.TEST.SPH PARAM.TEST
	cd CORELAX/SPHERICAL; make install

corelax_conf: corelax_src
	cd ..; rm -rf BATSRUS_conf; \
	ln -s BATSRUS/CORELAX/SPHERICAL BATSRUS_conf

corelax: corelax_src
	cd CORELAX/SPHERICAL; make

#^CFG END ALWAVES
