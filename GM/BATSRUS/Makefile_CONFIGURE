#^CFG COPYRIGHT UM
#^CFG FILE CONFIGURE

#^CFG IF NOT COVARIANT BEGIN
############################################################################

DCART =CARTESIAN
cartesian_src:
	./Configure.pl -keepall -exe=covariant -d=${DCART} -u
	cd CARTESIAN; make install

cartesian_conf: cartesian_src
	cd ..; rm -rf BATSRUS_conf; ln -s BATSRUS/${DCART} BATSRUS_conf

cartesian: cartesian_src

#^CFG END COVARIANT
#^CFG IF COVARIANT BEGIN
############################################################################

DSPHER =SPHERICAL
spherical_src:
	cd src;\
		mv user_routines_orig.f90 user_routines_tmp.f90;\
		cp user_routines_empty.f90 user_routines_orig.f90
	cd srcPostProc;\
		mv PostIDL.f90 PostIDL.tmp; mv PostIDL_SPH.f90 PostIDL.f90
	./Configure.pl -d=${DSPHER} \
	-off=boriscorr \
	-on=awflux,lindeflux,testing,userfiles,covariant -u
	cd src; \
		mv user_routines_tmp.f90 user_routines_orig.f90;
	cd srcPostProc;\
		mv PostIDL.f90 PostIDL_SPH.f90; mv PostIDL.tmp PostIDL.f90
	cd ${DSPHER}/Param;\
		mv PARAM.DEFAULT.SPH PARAM.DEFAULT;\
		mv EARTH/SSSSPH EARTH/SSSS;\
		mv PARAM.TEST.SPH PARAM.TEST
	cd ${DSPHER}/Param/TESTSUITE/Res/; mv DEFAULT.SPH DEFAULT
	cd ${DSPHER}; make install

spherical_conf: spherical_src
	cd ..; rm -rf BATSRUS_conf; ln -s BATSRUS/${DSPHER} BATSRUS_conf

spherical: spherical_src
	cd ${DSPHER}; make

############################################################################

DCOV =COVARIANT

covariant_src:
	cd src; mv user_routines_orig.f90 user_routines_tmp.f90;\
	cp user_routines_empty.f90 user_routines_orig.f90
	./Configure.pl -d=${DCOV} -off=boriscorr \
		-on=awflux,lindeflux,testing,userfiles,covariant \
	 -u
	cd src; mv user_routines_tmp.f90 user_routines_orig.f90
	cd ${DCOV}; make install

covariant_conf: covariant_src
	cd ..; rm -rf BATSRUS_conf; ln -s BATSRUS/${DCOV} BATSRUS_conf

covariant: covariant_src
	cd ${DCOV}; make

covarcheck_src:
	cd src; mv user_routines_orig.f90 user_routines_tmp.f90;\
	cp user_routines_empty.f90 user_routines_orig.f90
	./Configure.pl -d=COVARCHECK -off=boriscorr \
		-on=awflux,lindeflux,testing,userfiles -u
	cd src; mv user_routines_tmp.f90 user_routines_orig.f90
	cd COVARCHECK; make install

covarcheck_conf: covarcheck_src
	cd ..; rm -rf BATSRUS_conf; ln -s BATSRUS/COVARCHECK BATSRUS_conf

covarcheck: covarcheck_src
	cd COVARCHECK; make


#^CFG END COVARIANT
#^CFG IF GLOBALHELIOSPHERE BEGIN
############################################################################
DGLOBALH=GLOBALHELIOSPHERE
globhelio_src:
	cd src;mv user_routines_orig.f90 user_routines_tmp.f90;\
	cp user/user_routines.f90.globalhelio user_routines_orig.f90;\
	cd ..;\
	./Configure.pl -d=${DGLOBALH} -keepall \
	-off=ionosphere,boriscorr,implicit,roeflux,rcm,covariant \
	-on=globalheliosphere \
	-exe=ionosphere,boriscorr,implicit,roeflux,rcm,globalheliosphere,cartesian \
	-u
	cd src; mv -f user_routines_tmp.f90 user_routines_orig.f90
	cd ${DGLOBALH}; make install

globhelio_conf: globhelio_src
	cd ..; rm -rf BATSRUS_conf; \
	ln -s BATSRUS/${DGLOBALH} BATSRUS_conf

globhelio: globhelio_src
	cd ${DGLOBALH}; make

#^CFG END GLOBALHELIOSPHERE 
#^CFG IF MULTISP BEGIN
############################################################################

multisp_src:
	cd src;mv user_routines_orig.f90 user_routines_tmp.f90;\
	cp user/user_routines.f90.mars user_routines_orig.f90;\
	cd ..;\
	./Configure.pl -d=MULTISP -keepall \
	-off=implicit,ionosphere,rusanovflux,roeflux,awflux \
	-on=multisp \
	-exe=implicit,ionosphere,rusanovflux,roeflux,awflux,multisp \
	-u;\
	cd src; mv -f user_routines_tmp.f90 user_routines_orig.f90
	cd MULTISP; make install; make spherical_src
	cd MULTISP/${DSPHER}; make install

multisp_conf: multisp_src
	cd ..; rm -rf BATSRUS_conf; \
	ln -s BATSRUS/MULTISP/${DSPHER} BATSRUS_conf

multisp: multisp_src
	cd MULTISP/${DSPHER}; make

#^CFG END MULTISP
#^CFG IF ALWAVES BEGIN
############################################################################
DREL=RELAX
COMP=IH
relax_src:
	cd src;mv user_routines_orig.f90 user_routines_tmp.f90;\
	cp user/user_routines.f90.heliosphere user_routines_orig.f90;\
	cd ..;\
	./Configure.pl -d=${DREL} \
	-on=alwaves,awflux,userfiles,testing \
	-off=rusanovflux,ionosphere,boriscorr,covariant -u;\
	cd src; mv -f user_routines_tmp.f90 user_routines_orig.f90
	cd ${DREL}; rm -f CVS_Entries .cvsignore
	cd ${DREL}/srcInterface; \
		rm -f .cvsignore GM_* ModIeGrid.f90 *bc.f90 *BC.f90
	cd ${DREL}; make install; \
	perl -i -pe 's?GM?${COMP}?g' Makefile* Param/PARAM.DEFAULT

relax_conf: relax_src
	cd ..; rm -rf BATSRUS_conf; ln -s BATSRUS/${DREL} BATSRUS_conf

relax: relax_src
	cd ${DREL}; make

#^CFG END ALWAVES
#^CFG IF ALWAVES BEGIN
############################################################################

corelax_src:
	cd src;mv user_routines_orig.f90 user_routines_tmp.f90;\
	cp user/user_routines.f90.heliosphere.covariant user_routines_orig.f90
	./Configure.pl -d=CORELAX -keepall \
	-on=alwaves,awflux \
	-off=rusanovflux,ionosphere,boriscorr,implicit \
	-exe=alwaves,awflux,rusanovflux,ionosphere,boriscorr,implicit -u;\
	cd src; mv -f user_routines_tmp.f90 user_routines_orig.f90
	cd CORELAX/srcPostProc; \
		mv PostIDL.f90 PostIDL.tmp; mv PostIDL_SPH.f90 PostIDL.f90
	cd CORELAX;\
	./Configure.pl -d=${DSPHER} \
	-on=alwaves,awflux,testing,userfiles,covariant -u
	cd CORELAX/srcPostProc; \
		mv PostIDL.f90 PostIDL_SPH.f90;mv PostIDL.tmp PostIDL.f90
	cd CORELAX/${DSPHER}/Param;\
	mv PARAM.DEFAULT.SPH PARAM.DEFAULT;\
	mv EARTH/SSSSPH EARTH/SSSS;\
	cd TESTSUITE/Res/; mv DEFAULT.SPH DEFAULT; cd ../.. ;\
	mv PARAM.TEST.SPH PARAM.TEST
	cd CORELAX/${DSPHER}; make install

corelax_conf: corelax_src
	cd ..; rm -rf BATSRUS_conf; \
	ln -s BATSRUS/CORELAX/${DSPHER} BATSRUS_conf

corelax: corelax_src
	cd CORELAX/${DSPHER}; make

#^CFG END ALWAVES
