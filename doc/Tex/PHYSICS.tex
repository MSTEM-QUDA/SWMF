%^CFG COPYRIGHT UM
\documentclass[twoside,10pt]{article}

\input HEADER

\title{Physics of the Couplings in the Space Weather Modeling Framework\\
  \hfill \\
  \large Code Version \SWMFVERSION}

\author{Aaron J. Ridley\\
  {\it Center for Space Environment Modeling}\\
  {\it The University of Michigan}}

\begin{document}

\pagestyle{fancy}
\lhead[\fancyplain{}{\bfseries\thepage}]{\fancyplain{}{\bfseries\rightmark}}
\rhead[\fancyplain{}{\bfseries\leftmark}]{\fancyplain{}{\bfseries\thepage}}
\cfoot{}
%\pagestyle{headings} % if fancy heading does not work

\maketitle

\newpage

\tableofcontents

\newpage

\section{The components}

The following components are involved in the couplings
of the current distribution of SWMF:
\begin{itemize}

\item Solar Corona (SC).

\item Solar Energetic Particles (SP).

\item Inner Heliosphere (IH).

\item Global Magnetosphere Model (GM).

\item Inner Magnetosphere Model (IM).

\item Radiation Belt Model (RB).

\item Ionospheric Electrodynamics (IE).

\item Upper Atmosphere Model (UA).

\end{itemize}
We also describe here how couplings are envisioned for
the components
\begin{itemize}

\item Plasmasphere Model (PS).

\end{itemize}
The words ``A is coupled to B'' will mean that there is
information sent from A to B, while the words ``A and B are
coupled'' or ``A is coupled with B'' mean 
that there is information going both ways.

\section{Coupling the Solar Corona to the Inner Heliosphere}

The Solar Corona model encompasses the near-Sun region of space,
extending from the solar ``surface'' to 20 $R_s$ in each direction.
This model is run in a rotating coordinate system, so a true
steady-state can be created without having to run in time-accurate
mode.

\subsection{Technique in Initiating a Coronal Mass Ejection}

The SC model also contains the ``eruptive events generator''.  This
code inserts an unstable coronal loop structure that will erupt as
soon as the code starts.  This model is described in
\cite{manchester_cme}.

\subsection{Technique in Coupling SC and IH}

Because both the SC and IH codes are MHD codes, only the MHD states
need to be passed between the coponents.  This is done by having the
codes overlapping each other, and filling in the ghostcells of the IH
component with linearly interpolated values from the SC component.  In
addition, a corotation velocity is added to the velocity that is
passed from the SC to the IH component.  This is because the SC
component is in the corotating system, while the IH component is in a
fixed coordinate system.

It should be noted that the SC to IH coupling is only one way.  This
is because the flows are supersonic at the boundary between the SC and
IH components.  No information can flow back to the SC component from
the IH component in reality and in the framework.

\section{Coupling the Inner Heliosphere and Solar Corona to the 
Solar Energetic Particles}

The solar energetic particle component solves for particles that are
energized by MHD shocks that are produced in front of coronal mass
ejections.  These particles are accelerated along magnetic field
lines, so the code is written as being field-aligned.  This means that
the magnetic fields have to be traced from near the solar surface (in
the SC code) to the outer boundary of the IH code.  There is no
feedback from the SP component to the IH and SC components.

\subsection{Technique in Coupling SC, IH and SP}

When coupling the SC and IH to the SP, magnetic field lines must be
traced.  The BATS-R-US code has a field line tracing technique in it,
so these field lines are passed to the SP component.  In addition, the
MHD quantities are passed.

\section{Coupling the Inner Heliosphere to the Global Magnetosphere}

The GM needs to be driven by the solar wind flow in which it sits.
One method of accomplishing this is by using an upstream solar wind
monitor to feed the upstream boundary conditions of the GM.
Alternatively, the GM can be embedded into a full MHD IH model which
provides to the GM all relevant flow conditions at the necessary time
and location.  The GM needs a time and location varying set of data
which includes the solar wind density, pressure, velocity, and
magnetic field.

\section{Coupling the Global Magnetosphere and the Inner Magnetosphere}

The IM is coupled to the GM because in the ring current, the
gradient/curvature drift is typically faster than the $E \times B$
drift, which is neglected in ordinary MHD.  The IM model is
specifically designed for accuracy and efficiency for the conditions of
the inner magnetosphere.  This coupling is challenging as the IM needs
magnetic field line flux tube volumes which involve integrating along
many accurate field line traces.  A parallel method has been developed
to accomplish this in an efficient method which makes use of the
adaptive block data structure of the GM.

\subsection{Technique in Coupling GM and IM}

The coupling of GM and IM involves an exchange of information between
the models.  Not including the initialization of coupling, the process
of sending data to the IM includes
\begin{enumerate}
\item Ray Tracing.  Magnetic field lines in the GM are traced so that
  each point know the location of the endpoints of the field line that
  passes through it.
\item Field Integration.  Using the ray tracing information, the flux
  tube volumes as well as the average density and pressure on the field
  line are computed and passed to the IM.
\end{enumerate}

The IM takes this information and computes the drift trajectories for
the distribution of energy channels.  It then sums up the pressure
contribution from each energy channel for a new single pressure to send
to GM.

\section{Coupling the Global Magnetosphere and \\
         the Upper Atmosphere/Ionosphere models}

The ionosphere is highly controlled by the magnetosphere.  This is
done through the transfer of particles, momentum, and energy from the
magnetosphere to the ionosphere.  The ionosphere influences the
magnetosphere through the dissipation of energy and transfer of
particles from the ionosphere to the magnetosphere.  Specifically,
the magnetosphere transfers:

\begin{itemize}

\item
Field-aligned currents.  These currents cause electric fields which 
force the ions and electrons to advect.

\item
High-energy electron and ion precipitation (i.e. the aurora).  This
precipitation cause both heating and ionization.

\item
Heat.  The magnetosphere is much hotter than the ionosphere.  This
heat is conducted along magnetic field lines quite easily.  Therefore,
there is significant heating from the magnetosphere to the ionosphere.

\item
Low energy ion inflow.  This takes place when the ionospheric density
becomes lower than the plasmaspheric density.

\end{itemize}

The ionosphere then provides to the magnetosphere:

\begin{itemize}

\item
Ionosphere conductances.  These conductances allow the magnetospheric
currents to close, and are driven primarily by particle precipitation
(i.e. the aurora) and solar EUV ionization.

\item
Ionospheric outflow.  This is the outflow of very low energy hydrogen,
helium, and oxygen into the magnetosphere.

\item
Currents driven by the neutral winds.  These currents allow more or
less magnetospheric current to close through ionosphere.

\end{itemize}

Within the ionosphere itself, there are a number of processes that
must be coupled.  For example, when the sun shines on one hemisphere
and not the other, excited photoelectrons travel along field lines and
precipitate into the other hemisphere, causing ionization.  This
interhemispheric transference is true of currents and low energy
particles also.  The method for doing this transference can be done
within the upper atmosphere model itself or through some coupling with
external modules.  Neither of these things exists at this time.

\subsection{Technique in coupling IE with GM}

\cite{goodman95} described in great detail the methodology for solving
for the inner boundary condition in a global MHD code.  This
methodology has been incorporated into the University of Michigan MHD
code \cite{powell99, ridley_aec, ridley_metrics}.  The method can be
summarized in the following steps:

\begin{enumerate}

\item
The field-aligned currents at 3.5 R$_E$ are computed using
$J_{\parallel} = ({\nabla}{\times}{\mathbf{B}}){\cdot}{\mathbf{b}}$,
where $J_{\parallel}$ is the field-aligned current, $\mathbf{B}$ is
the local magnetic field, and $\mathbf{b}$ is the direction of the
local magnetic field. (Global Magnetosphere)

\item
These field-aligned currents are mapped down to the ionosphere using
the background (i.e. dipolar) magnetic field, and scaled according to
the ratio $B_{E}/B_{3.5}$, where $B_{3.5}$ and $B_{E}$ are the
strengths of the magnetic field at 3.5 $R_E$ and the ionosphere,
respectfully. (Global Magnetosphere and Ionosphere Electrodynamics)

\item
An auroral precipitation pattern is generated based on the
field-aligned currents from the magnetosphere. (Ionosphere
Electrodynamics)

\item
The auroral pattern and the solar illumination are used to generate
Hall and Pedersen conductances.  This can be done through the use of
the \cite{robinson87} and \cite{moen93} formulation, which takes the
average and total electron energy flux and converts them to Hall and
Pedersen conductances based on a simple formula.  It can also be done
through the use of the upper atmosphere model. (Upper Atmosphere
Model or empirical formula)

\item
The electric potential is solved for using the relationship $j_R(R_E)
=[{\nabla}_{\perp}{\cdot}({\Sigma}{\cdot}{\nabla}{\psi})_{\perp}]_{R=R_E}$,
where $\Sigma$ is the ionospheric conductance tensor, and $\psi$ is
the potential. (Ionosphere Electrodynamics)

\item
The ionospheric potential is mapped to the inner boundary of the
simulation (i.e. 2.5 R$_E$), using the background magnetic field.
(Global Magnetosphere or Ionosphere Electrodynamics Coupler)

\item
The electric fields and velocities at the inner boundary are
calculated using the relationships $\mathbf{E}=-{\nabla}{\psi}$ and
$\mathbf{V}=\mathbf{E}{\times}\mathbf{B}/B^2$, where $\mathbf{E}$ is
the electric field.  At this point, the corotation velocity field is
added to the ionospheric generated velocity field.  The total velocity
field is used as an inner boundary condition in the simulation.
(Global Magnetosphere)

\end{enumerate}

\subsection{Technique in coupling IE with UA}

The ionospheric electrodynamics module is essential in the use of the
upper atmosphere model.  This is because the thermosphere and
ionosphere are so strongly driven by the high-latitude inputs, as
described above.  This means that UA must be run with IE all the time.
The IE module can be scaled down significantly, but it must exist.
The UA model must get from the IE module: (1) The high-latitude
potential pattern; (2) the low-latitude potential pattern; and (3) an
electron precipitation pattern including average and total electron
energy flux.

There are two different ways of doing the coupling: (1) a
self-consistent method, in which the neutral wind driven currents and
ionospheric conductivities are taken into account; or (2) an
externally driven model in which there is a one-way coupling between
IE and UA, and the IE module is a set of empirically driven models.
These two methods for coupling must exist within the framework.  If
the model is run in a self-consistent way, the GM model must be
run with the IE and UA modules.

The self-consistent method can be described as:

\begin{enumerate}

\item
The field-aligned currents (FACs) are calculated in the global
magnetosphere.  (Global Magnetosphere)

\item
The FACs are used to determine the auroral precipitation. (Ionospheric
Electrodynamics)

\item
The auroral precipitation is used to calculate ionization rates, which
are used to calculate electron densities.  These electron densities
are used to calculate ionospheric conductivities.  The conductivities
are used to calculate local neutral wind field-aligned currents.  The
FACs and conductivities are integrated along the field lines to
generate the Hall and Pedersen conductances and neutral wind FACs.
The method for calculating the UA FACs is described in
\cite{ridley_coupled} and references within. (Upper Atmosphere)

\item
The magnetospheric and ionospheric driven FACs are combined. (Ionospheric
Electrodynamics)

\item
The electric potential is solved for using the relationship $j_R(R_E)
=[{\nabla}_{\perp}{\cdot}({\Sigma}{\cdot}{\nabla}{\psi})_{\perp}]_{R=R_E}$,
where $\Sigma$ is the ionospheric conductance tensor, and $\psi$ is
the potential. (Ionosphere Electrodynamics)

\item
The potential is used as described above in the global magnetosphere model.
(Global Magnetosphere)

\item
The potential is applied to the upper atmosphere model in each grid
cell through the mapping of the field lines.  The gradient of the
potential is taken in each direction to calculate the electric field.
$\mathbf{E} \times \mathbf{B}$ are calculated to drive the ion motion.

\end{enumerate}

\subsection{Technique in coupling GM with UA}

This coupling is not part of the framework at this time, but we describe
the coupling here anyways.

Most of the coupling between these two models is done through the use
of the ionospheric electrodynamics module, as described above.  Other
physical quantities are needed to be transfered between the two: (1)
heat flux from the magnetosphere to the upper atmosphere; and (2)
ionospheric outflow from the upper atmosphere to the magnetosphere.

There are problems with this coupling, due to the lack of physics
within each of the models.  For example, the ionospheric outflow
should be specified in terms of the flux of hydrogen, helium, and
oxygen.  The upper atmosphere model is unable to to specify these
quantities, and the global magnetosphere is unable to take them.  With
the heat flux, the global magnetosphere code does not calculate the
heat flux at the lower boundary, but the upper atmosphere model does
use a heat flux at the upper boundary.  The current heat flux is
empirical.

Once the physical limitations of the code are over come, the coupling
is easy, since they are simple fluxes on a 2-D sphere.

\subsection{Technique in Coupling PS and UA}

This coupling is very similar to the coupling with UA and GM, in that
the UA provides particle fluxes to the plasmasphere.  The plasmasphere
also provides a flux of particles to the upper atmosphere when the
density in the ionosphere becomes too low.

As state above, the outflow in the upper atmosphere model does not
exist yet.  Once it is implemented, the outflow coupling with the PS
will be identical to the outflow coupling with the GM.

The inflow of particles from the plasmasphere to the ionosphere will
be more difficult to do.  The regions and times of inflow will have to
be determined by examining the plasma pressure in the lower
plasmasphere and upper atmosphere to determine whether they are in
hydrostatic equilibrium or not.  If the plasmaspheric pressure becomes
larger than the ionospheric pressure (compared to gravity), then
inflows should occur.  The exact coupling will be almost exactly the
reverse of the UA to PS coupling, but only in the regions and at time
when it is needed.

\subsection{Technique in Coupling RB and UA}

The coupling from the radiation belts to the upper atmosphere model
basically comes in the form of high energy particle precipitation,
similar to the coupling from GM to IE.  This coupling can be done
through the use of the IE model, but the IE model assumes a Maxwellian
distribution of particles, which is not the case for the radiation
belts.  In addition, the radiation belt particles may not effect the
ionospheric conductance significantly, but they may change the
chemistry and temperature structure of the lower thermosphere.  One
way of coupling may be to pass the particle fluxes directly from the
RB model to the UA model.

\subsection{Technique in Coupling IM and UA}

The coupling between IM and UA can basically be done through the IE
module also.  The IM model provides particle precipitation and
field-aligned currents and needs the electric potential, similar to
the GM model.  One problem with this is that the IE model assumes a
Maxwellian distribution of the particle fluxes and does not include
the ion precipitation.  The IM model can provide both non-Maxwellian
distributions and ion precipitation.  This would involve changing the
IE module to allow this physics.  For now, the coupling will be done
through the IE module.

%\subsection{Flow of Coupling}

\begin{thebibliography}{{\em Moen and Brekke}(1993}

\bibitem[{\em Goodman}(1995)]{goodman95}
Goodman, M.~L.,
\newblock A three-dimensional, iterative mapping procedure for the
  implementation of an ionosphere-magnetosphere anisotropic {Ohm's} law
  boundary condition in global magnetohydrodynamic simulations,
\newblock {\em Ann. Geophysic.}, {\em 13}, 843, 1995.

\bibitem[{\em Manchester et al.}(2004)]{manchester_cme} Manchester IV,
W. B., T. I. Gombosi, I.I Roussev, D.L. De Zeeuw, I.V. Sokolov,
G. Toth, M. Opher, K.G. Powell \newblock Three-Dimensional MHD
Simulation of a Flux Rope Driven CME, \newblock {\em
J. Geophys. Res.}, {\em 109}, A01102, doi: 10.1029/2002JA009672, 2004.

\bibitem[{\em Moen and Brekke}(1993)]{moen93}
Moen, J., and A.~Brekke,
\newblock The solar flux influence os quiet-time conductances in the auroral
  ionosphere,
\newblock {\em Geophys. Res. Lett.}, {\em 20}, 971, 1993.

\bibitem[{\em Powell et~al.}(1999)]{powell99}
Powell, K.G., P.L. Roe, T.J. Linde, T.I. Gombosi, and D.L.~De Zeeuw,
\newblock A solution-adaptive upwind scheme for ideal magnetohydrodynamics,
\newblock {\em J. Comp. Phys.}, {\em 154}, 284, 1999.

\bibitem[{\em Ridley et~al.}(2001)]{ridley_aec}
Ridley, A.J., D.L.~De Zeeuw, T.I. Gombosi, and K.G. Powell,
\newblock Using steady-state mhd results to predict the global state of the
  magnetosphere-ionosphere system,
\newblock {\em J. Geophys. Res.}, {\em 106}, 30,067, 2001.

\bibitem[{\em Ridley et~al.}(2002a)]{ridley_coupled}
Ridley, A.J., T.I. Gombosi, D.L.~De Zeeuw, C.R. Clauer, and A.D. Richmond,
\newblock Ionospheric control of the magnetospheric configuration: Neutral
  winds,
\newblock {\em J. Geophys. Res.}, page To be submitted, 2002a.

\bibitem[{\em Ridley et~al.}(2002b)]{ridley_metrics}
Ridley, A.J., K.C. Hansen, G.~T\'oth, D.L.~De Zeeuw, T.I. Gombosi, and K.G.
  Powell,
\newblock University of michigan mhd results of the ggcm metrics challenge,
\newblock {\em J. Geophys. Res.}, page In Press, 2002b.

\bibitem[{\em Robinson et~al.}(1987)]{robinson87}
Robinson, R.M., R.R. Vondrak, K.~Miller, T.~Dabbs, and D.A. Hardy,
\newblock On calculating ionospheric conductances from the flux and energy of
  precipitating electrons,
\newblock {\em J. Geophys. Res.}, {\em 92}, 2565, 1987.

\end{thebibliography}

\end{document}
